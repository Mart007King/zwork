# wy-chat

## Properties

| Property                        | Attribute  | Modifiers | Type                                             | Default                                          | Description                                  |
|---------------------------------|------------|-----------|--------------------------------------------------|--------------------------------------------------|----------------------------------------------|
| `availableFeatures`             |            |           | `FeaturesListType \| undefined`                  |                                                  |                                              |
| `conversation`                  |            |           | `ConversationType \| undefined`                  |                                                  |                                              |
| `cssClass`                      | `cssClass` |           | `string \| undefined`                            |                                                  |                                              |
| `features`                      | `features` |           | `FeaturesConfigType`                             | {}                                               |                                              |
| `featuresQuery`                 |            |           | `QueryController<FeaturesListType>`              | "new QueryController<FeaturesListType>(this)"    |                                              |
| `handleRealtimeAppUpdated`      |            |           | `(realtimeEvent: RealtimeAppEventType) => void`  | "(realtimeEvent: RealtimeAppEventType) => {\n    if (!this.conversation \|\| realtimeEvent.app.id !== this.conversation.id) {\n      return;\n    }\n\n    this.conversationTitle = this.conversationTitleInput = realtimeEvent.app.display_name;\n  }" |                                              |
| `handleRealtimeDelivered`       |            |           | `(realtimeEvent: RealtimeConversationDeliveredEventType) => void` | "(realtimeEvent: RealtimeConversationDeliveredEventType) => {\n    if (\n      !this.weavyContext \|\|\n      !this.conversation \|\|\n      realtimeEvent.actor.id === this.user!.id \|\|\n      realtimeEvent.conversation.id !== this.conversation!.id\n    ) {\n      return;\n    }\n\n    updateCacheItem(\n      this.weavyContext.queryClient,\n      [\"members\", this.conversation.id],\n      realtimeEvent.actor.id,\n      (item: MemberType) => {\n        item.delivered_at = realtimeEvent.delivered_at;\n      }\n    );\n  }" |                                              |
| `handleRealtimeMessage`         |            |           | `(realtimeEvent: RealtimeMessageEventType) => void` | "(realtimeEvent: RealtimeMessageEventType) => {\n    if (\n      !this.weavyContext \|\|\n      !this.conversation \|\|\n      !this.user \|\|\n      realtimeEvent.message.app_id !== this.conversation.id \|\|\n      realtimeEvent.message.created_by_id === this.user.id\n    ) {\n      return;\n    }\n\n    realtimeEvent.message.created_by = realtimeEvent.actor;\n    addCacheItem(this.weavyContext.queryClient, [\"messages\", this.conversation.id], realtimeEvent.message);\n\n    // mark as read\n    if (!this.isContextualChat()) {\n      this.markConversationMutation?.mutate({\n        id: this.conversation!.id,\n        markAsRead: true,\n        messageId: realtimeEvent.message.id,\n      });\n    }\n\n    // display toast\n    if (!this.isAtBottom && !this.lastReadMessageId) {\n      this.lastReadMessageId = realtimeEvent.message.id;\n      this.lastReadMessagePosition = \"top\";\n    }\n  }" |                                              |
| `handleRealtimeReactionAdded`   |            |           | `(realtimeEvent: RealtimeReactionEventType) => void` | "(realtimeEvent: RealtimeReactionEventType) => {\n    if (!this.weavyContext \|\| !this.user \|\| !this.conversation \|\| realtimeEvent.actor.id === this.user.id) {\n      return;\n    }\n\n    updateCacheItem(\n      this.weavyContext.queryClient,\n      [\"messages\", this.conversation.id],\n      realtimeEvent.entity.id,\n      (item: MessageType) => {\n        item.reactions = [\n          ...(item.reactions \|\| []),\n          { content: realtimeEvent.reaction, created_by_id: realtimeEvent.actor.id },\n        ];\n      }\n    );\n  }" |                                              |
| `handleRealtimeReactionDeleted` |            |           | `(realtimeEvent: RealtimeReactionEventType) => void` | "(realtimeEvent: RealtimeReactionEventType) => {\n    if (!this.weavyContext \|\| !this.conversation \|\| !this.user \|\| realtimeEvent.actor.id === this.user.id) {\n      return;\n    }\n    updateCacheItem(\n      this.weavyContext.queryClient,\n      [\"messages\", this.conversation.id],\n      realtimeEvent.entity.id,\n      (item: MessageType) => {\n        item.reactions = item.reactions.filter((item) => item.created_by_id !== realtimeEvent.actor.id);\n      }\n    );\n  }" |                                              |
| `handleRealtimeSeenBy`          |            |           | `(realtimeEvent: RealtimeConversationMarkedEventType) => void` | "(realtimeEvent: RealtimeConversationMarkedEventType) => {\n    if (\n      !this.weavyContext \|\|\n      !this.conversation \|\|\n      this.isContextualChat() \|\|\n      realtimeEvent.conversation.id !== this.conversation.id\n    ) {\n      return;\n    }\n\n    updateCacheItem(\n      this.weavyContext.queryClient,\n      [\"members\", this.conversation.id],\n      realtimeEvent.actor.id,\n      (item: MemberType) => {\n        item.marked_id = realtimeEvent.marked_id;\n        item.marked_at = realtimeEvent.marked_at;\n      }\n    );\n  }" |                                              |
| `isAtBottom`                    |            | readonly  | `boolean`                                        |                                                  |                                              |
| `lastReadMessageId`             |            |           | `number \| undefined`                            |                                                  |                                              |
| `lastReadMessagePosition`       |            |           | `"top" \| "bottom"`                              | "bottom"                                         |                                              |
| `membersQuery`                  |            |           | `QueryController<MembersResultType>`             | "new QueryController<MembersResultType>(this)"   |                                              |
| `messagesQuery`                 |            |           | `InfiniteQueryController<MessagesResultType>`    | "new InfiniteQueryController<MessagesResultType>(this)" |                                              |
| `realtimeAppUpdatedEvent`       |            |           | `(realtimeEvent: RealtimeAppEventType) => void`  | "(realtimeEvent: RealtimeAppEventType) => {\n    if (!this.conversation \|\| realtimeEvent.app.id !== this.conversation.id) {\n      return;\n    }\n    \n    this.dispatchEvent(new CustomEvent(\"wy:app_updated\", { bubbles: true, composed: false, detail: realtimeEvent }));\n  }" | Event: Conversation app details updated.     |
| `realtimeMessageCreatedEvent`   |            |           | `(realtimeEvent: RealtimeMessageEventType) => void` | "(realtimeEvent: RealtimeMessageEventType) =>{\n    if (\n      !this.weavyContext \|\|\n      !this.conversation \|\|\n      !this.user \|\|\n      realtimeEvent.message.app_id !== this.conversation.id \|\|\n      realtimeEvent.message.created_by_id === this.user.id\n    ) {\n      return;\n    }\n\n    this.dispatchEvent(new CustomEvent(\"wy:message_created\", { bubbles: true, composed: false, detail: realtimeEvent }));\n  }" | Event: New message created.                  |
| `realtimeReactionAddedEvent`    |            |           | `(realtimeEvent: RealtimeReactionEventType) => void` | "(realtimeEvent: RealtimeReactionEventType) => {\n    if (!this.weavyContext \|\| !this.user \|\| !this.conversation \|\| realtimeEvent.actor.id === this.user.id) {\n      return;\n    }\n    \n    this.dispatchEvent(new CustomEvent(\"wy:reaction_added\", { bubbles: true, composed: false, detail: realtimeEvent }));\n  }" | Event: Message reaction added.               |
| `realtimeReactionRemovedEvent`  |            |           | `(realtimeEvent: RealtimeReactionEventType) => void` | "(realtimeEvent: RealtimeReactionEventType) => {\n    if (!this.weavyContext \|\| !this.conversation \|\| !this.user \|\| realtimeEvent.actor.id === this.user.id) {\n      return;\n    }\n    this.dispatchEvent(new CustomEvent(\"wy:reaction_removed\", { bubbles: true, composed: false, detail: realtimeEvent }));\n  }" | Event: Message reaction removed.             |
| `releaseFocusEvent`             |            |           | `() => CustomEvent<undefined>`                   | "() => new CustomEvent<undefined>(\"release-focus\", { bubbles: true, composed: true })" | A keyboard-consuming element releases focus. |
| `uid`                           | `uid`      |           | `string \| undefined`                            |                                                  |                                              |
| `user`                          |            |           | `UserType \| undefined`                          |                                                  |                                              |
| `userQuery`                     |            |           | `QueryController<UserType>`                      | "new QueryController<UserType>(this)"            |                                              |

## Methods

| Method             | Type                                             |
|--------------------|--------------------------------------------------|
| `isChatRoom`       | `(conversation?: ConversationType \| undefined): boolean` |
| `isContextualChat` | `(conversation?: ConversationType \| undefined): boolean` |
| `isPrivateChat`    | `(conversation?: ConversationType \| undefined): boolean` |
| `performUpdate`    | `(): Promise<void>`                              |
| `scrollToBottom`   | `(): void`                                       |

## Events

| Event                 | Type                                     |
|-----------------------|------------------------------------------|
| `release-focus`       | `CustomEvent<undefined>`                 |
| `wy:app_updated`      | `CustomEvent<RealtimeAppEventType>`      |
| `wy:message_created`  | `CustomEvent<RealtimeMessageEventType>`  |
| `wy:reaction_added`   | `CustomEvent<RealtimeReactionEventType>` |
| `wy:reaction_removed` | `CustomEvent<RealtimeReactionEventType>` |
